!function(t){function e(s){if(i[s])return i[s].exports;var o=i[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(t){T=window.innerWidth,w=window.innerHeight,_=new THREE.Scene,y=new THREE.PerspectiveCamera(W.default.FOV,T/w,W.default.NEAR,W.default.FAR),b=new THREE.Clock,m=new THREE.WebGLRenderer,m.setSize(T,w),S=new THREE.DirectionalLight(16777215,1),n(!0),_.add(S),_.add(new THREE.AmbientLight(3355443)),t.appendChild(m.domElement),C=new M.default(y),r(),u(function(){a(l)})}function n(t){t?(S.shadowDarkness=W.default.SHADOW_DARKNESS,S.shadowCameraNear=W.default.SHADOW_NEAR,S.shadowCameraFar=W.default.SHADOW_FAR,S.shadowCameraLeft=-W.default.SHADOW_CAMERA_SIZE,S.shadowCameraRight=W.default.SHADOW_CAMERA_SIZE,S.shadowCameraTop=W.default.SHADOW_CAMERA_SIZE,S.shadowCameraBottom=-W.default.SHADOW_CAMERA_SIZE,S.shadowMapWidth=W.default.SHADOW_MAP_SIZE,S.shadowMapHeight=W.default.SHADOW_MAP_SIZE):S.position.copy(W.default.LIGHT_SOURCE),m.shadowMapEnabled=t,S.castShadow=t}function a(t){var e=A.default.Computers.Green;x=new O.default(e,g,_),v=new L.default(x,0,640,640,W.default.DOWN),x.addPlayer(v),C.subject=v.lightCycle.models[4],t()}function r(){window.addEventListener("resize",c),window.addEventListener("keydown",h),window.addEventListener("keyup",d)}function u(t){var e={models:{},textures:{"textures/circuit.png":0,"textures/grid.png":0}};g=new P.default,g.autoLoad(e,function(){},t)}function l(){f()}function c(){T=window.innerWidth,w=window.innerHeight,m.setSize(T,w),y.aspect=T/w,y.updateProjectionMatrix()}function h(t){switch(t.keyCode){case 37:case 65:v.turn(-1),t.preventDefault();break;case 39:case 68:v.turn(1),t.preventDefault();break;case 67:C.switchSubjectOffset();break;case 87:C.switchOffset(1);break;case 81:C.switchRotation(1);break;case 69:C.switchRotation(2)}}function d(t){switch(t.keyCode){case 87:C.switchOffset(0);break;case 81:C.cancelSwitchRotation(1);break;case 69:C.cancelSwitchRotation(2)}}function f(){requestAnimationFrame(f);var t=b.getDelta();x.tic(t),C.tic(t),S.castShadow&&(S.position.copy(C.subject.position),S.position.add(W.default.LIGHT_SOURCE),S.target.position.copy(C.subject.position)),m.render(_,y)}function p(){if(!("WebSocket"in window))return"Your browser doesn't support WebSockets.";for(var t=["webgl","experimental-webgl","webkit-3d","moz-webgl"],e=!1,i=0,s=t.length;i<s;i++)try{var o=document.createElement("canvas").getContext(t[i]);if(o){e=!0;break}}catch(t){}return e?null:"Your browser doesn't support WebGL."}function E(){var t=document.getElementsByClassName("initialMessage")[0],e=p();if(null!=e)return void(t.textContent=e);t.parentElement.removeChild(t);var i=document.createElement("div");i.setAttribute("class","canvasContainer"),document.body.appendChild(i),o(i)}var T,w,y,S,_,m,v,C,g,x,b,R=i(1),A=s(R),I=(i(2),i(3)),M=s(I),H=i(6),O=s(H),D=i(8),L=s(D),j=i(11),P=s(j),N=i(5),W=s(N);E()},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={MOVE_SPEED:15,CELL_SIZE:.1,Computers:{Green:{cells:1280,circuitTexture:"textures/circuit.png",gridTexture:"textures/grid.png",lightCycleTextures:["textures/light_cycle_01.png","textures/light_cycle_02.png","textures/light_cycle_03.png","textures/light_cycle_04.png"]}}};e.default=i},function(t,e){"use strict";function i(t,e){var i=t-e;return t<0&&i>=0||t>0&&i<=0}Object.defineProperty(e,"__esModule",{value:!0}),e.changesSign=i},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(t){this.camera=t,this.offsetIndex=0,this.rotIndex=0,this.distance=new a.default(u.default.DISTANCES[this.offsetIndex]),this.angle=new a.default(u.default.ANGLES[this.offsetIndex]*Math.PI/180),this.rotation=new a.default(u.default.ROTATIONS[this.rotIndex]*Math.PI/180),this.subject=null,this.subjectDistIndex=0,this.subjectDist=u.default.SUBJECT_DISTANCES[this.subjectDistIndex],this.subjectAngle=-Math.PI/2,this.subjectLookAt=new THREE.Vector3}Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(4),a=s(n),r=i(5),u=s(r);o.prototype.tic=function(t){this.distance.changing&&this.distance.useIncrement(t*u.default.DISTANCE_SPEED),this.angle.changing&&this.angle.useIncrement(t*u.default.ANGLE_SPEED),this.rotation.changing&&this.rotation.useIncrement(t*u.default.ROTATION_SPEED),this.subjectLookAt.copy(this.subject.position);var e=this.subjectAngle-this.subject.rotation.y;this.subjectLookAt.x+=this.subjectDist*Math.cos(e),this.subjectLookAt.z+=this.subjectDist*Math.sin(e),this.camera.position.copy(this.subjectLookAt),this.camera.position.y+=this.distance.value*Math.cos(this.angle.value);var i=this.distance.value*Math.sin(this.angle.value),s=this.rotation.value-this.subject.rotation.y;this.camera.position.x+=i*Math.cos(s),this.camera.position.z+=i*Math.sin(s),this.camera.lookAt(this.subjectLookAt)},o.prototype.switchSubjectOffset=function(){this.subjectDistIndex++,this.subjectDistIndex%=u.default.SUBJECT_DISTANCES.length,this.subjectDist=u.default.SUBJECT_DISTANCES[this.subjectDistIndex]},o.prototype.switchOffset=function(t){this.offsetIndex=t,this.distance.setGoal(u.default.DISTANCES[this.offsetIndex]),this.angle.setGoal(u.default.ANGLES[this.offsetIndex]*Math.PI/180)},o.prototype.switchRotation=function(t){this.rotIndex=t,this.rotation.setGoal(u.default.ROTATIONS[this.rotIndex]*Math.PI/180)},o.prototype.cancelSwitchRotation=function(t){t===this.rotIndex&&this.switchRotation(0)}},function(t,e){"use strict";function i(t){this.value=t,this.valueBecome=t,this.changing=!1}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i,i.prototype.useIncrement=function(t){this.value>this.valueBecome?(this.value-=t,this.value<=this.valueBecome&&(this.value=this.valueBecome,this.changing=!1)):(this.value+=t,this.value>=this.valueBecome&&(this.value=this.valueBecome,this.changing=!1))},i.prototype.setGoal=function(t){this.value!==t&&(this.valueBecome=t,this.changing=!0)}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={FOV:60,NEAR:1,FAR:100,ROTATIONS:[180,90,270],DISTANCES:[12,26],ANGLES:[55,40],ROTATION_SPEED:8,DISTANCE_SPEED:75,ANGLE_SPEED:2,SUBJECT_DISTANCES:[1,0,-1,0],SHADOW_DARKNESS:.8,SHADOW_NEAR:1,SHADOW_FAR:100,SHADOW_CAMERA_SIZE:20,SHADOW_MAP_SIZE:1024,RIGHT:0,DOWN:1,LEFT:2,UP:3,TURN_SPEED:8,TRAIL_HEIGHT:.8,LIGHT_SOURCE:new THREE.Vector3(5,10,5)};e.default=i},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e,i){this.opt=t,this.resources=e,this.scene=i,this.size=t.cells*a.default.CELL_SIZE,this.grounds=[],this.players={},this.setUp()}Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(1),a=s(n),r=i(7),u=s(r);o.prototype.setUp=function(){var t,e,i;for(t=-1;t<=1;t++)for(e=-1;e<=1;e++)i=new u.default(this.opt,this.resources),i.object.position.x=t*this.size,i.object.position.z=e*this.size,this.grounds.push(i),this.scene.add(i.object)},o.prototype.addPlayer=function(t){this.players[t.id]=t},o.prototype.removePlayer=function(t){delete this.players[t.id]},o.prototype.tic=function(t){for(var e in this.players)this.players[e].tic(t)}},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e){this.object=new THREE.Object3D,this.loadObjects(t,e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(1),a=s(n);o.prototype.loadObjects=function(t,e){var i=t.cells*a.default.CELL_SIZE,s=e.getTexture(t.circuitTexture);s.repeat.set(4,4),s.wrapS=THREE.RepeatWrapping,s.wrapT=THREE.RepeatWrapping;var o=new THREE.PlaneGeometry(i,i),n=new THREE.MeshLambertMaterial({map:s}),r=new THREE.Mesh(o,n);r.rotation.x=.5*-Math.PI,r.position.set(i/2,-2,i/2),r.receiveShadow=!0,this.object.add(r),s=e.getTexture(t.gridTexture),s.repeat.set(16,16),s.wrapS=THREE.RepeatWrapping,s.wrapT=THREE.RepeatWrapping,o=new THREE.PlaneGeometry(i,i),n=new THREE.MeshLambertMaterial({map:s,transparent:!0,opacity:.5}),r=new THREE.Mesh(o,n),r.rotation.x=.5*-Math.PI,r.position.set(i/2,0,i/2),this.object.add(r)}},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e,i,s,o){this.computer=t,this.id=e,this.lightCycle=new a.default(t,i,s,o),this.trail=new u.default(t),this.trail.startAt(i,s)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(9),a=s(n),r=i(10),u=s(r);o.prototype.tic=function(t){this.lightCycle.tic(t);var e=this.lightCycle;e.inNewCell&&this.trail.modify(e.xCell,e.yCell,e.direction)},o.prototype.turn=function(t){var e=this.lightCycle;e.moveToClosestCell(),this.trail.endAt(e.xCell,e.yCell,e.direction),e.turn(t),this.trail.startAt(e.xCell,e.yCell)}},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e,i,s){this.computer=t,this.direction=s,this.leftToTurn=0,this.models=[],this.setUpModels(e,i),this.xCell=e,this.yCell=i,this.inNewCell=!0}Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(1),a=s(n),r=i(2),u=i(5),l=s(u);o.prototype.setUpModels=function(t,e){for(var i,s=t*a.default.CELL_SIZE+a.default.CELL_SIZE/2,n=e*a.default.CELL_SIZE+a.default.CELL_SIZE/2,r=0;r<9;r++)i=o.loadNewModel(this.computer),i.position.x=s,i.position.z=n,i.rotation.y=-this.direction*Math.PI/2,this.models.push(i),this.computer.grounds[r].object.add(i)},o.prototype.remove=function(){for(var t=0;t<9;t++)this.computer.grounds[t].object.remove(this.models[t])},o.prototype.moveToClosestCell=function(){var t=a.default.CELL_SIZE,e=this.models[0].position;this.xCell=Math.floor(e.x/t),this.yCell=Math.floor(e.z/t);for(var i=(this.xCell+.5)*t,s=(this.yCell+.5)*t,o=0;o<9;o++)e=this.models[o].position,e.x=i,e.z=s},o.prototype.turn=function(t){this.direction=(this.direction+t+4)%4,this.leftToTurn-=t*Math.PI/2},o.prototype.tic=function(t){var e,i,s,o,n,u,c=this.computer.size;for(e=a.default.MOVE_SPEED*t,i=this.models[0].position,o=i.x,n=i.z,this.direction===l.default.RIGHT?o=(o+e+c)%c:this.direction===l.default.DOWN?n=(n+e+c)%c:this.direction===l.default.LEFT?o=(o-e+c)%c:this.direction===l.default.UP&&(n=(n-e+c)%c),u=0;u<9;u++)i=this.models[u].position,i.x=o,i.z=n;var h=a.default.CELL_SIZE,d=Math.floor(o/h),f=Math.floor(n/h);if(d!==this.xCell||f!==this.yCell?(this.xCell=d,this.yCell=f,this.inNewCell=!0):this.inNewCell=!1,0!==this.leftToTurn)for(e=t*l.default.TURN_SPEED,this.leftToTurn<0&&(e=-e),s=this.models[0].rotation.y,(0,r.changesSign)(this.leftToTurn,e)?(s+=this.leftToTurn,this.leftToTurn=0):(s+=e,this.leftToTurn-=e),u=0;u<9;u++)this.models[u].rotation.y=s},o.loadNewModel=function(t){var e=new THREE.Object3D,i=new THREE.CubeGeometry(2.5,1,.5),s=new THREE.MeshPhongMaterial({map:t.resources.getTexture(t.opt.lightCycleTextures[0])}),o=new THREE.Mesh(i,s);return o.position.y=.5,o.castShadow=!0,e.add(o),i=new THREE.SphereGeometry(.6,16,16),o=new THREE.Mesh(i,s),o.position.x+=.75,o.position.y+=.3,o.castShadow=!0,e.add(o),i=new THREE.SphereGeometry(.7,16,16),o=new THREE.Mesh(i,s),o.position.x-=.75,o.position.y+=.35,o.castShadow=!0,e.add(o),e}},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(t){this.computer=t,this.newTrails=[],this.startedX=0,this.startedY=0}Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(1),a=s(n),r=i(5),u=s(r);o.XOFF=[-1,-1,-1,0,0,0,1,1,1],o.ZOFF=[-1,0,1,-1,0,1,-1,0,1],o.prototype.startAt=function(t,e){this.startedX=t,this.startedY=e;var i,s,o,n=a.default.CELL_SIZE,r=n/2,l=u.default.TRAIL_HEIGHT/2,c=this.computer.size,h=new THREE.CubeGeometry(n,.8,n),d=new THREE.MeshPhongMaterial({map:this.computer.resources.getTexture(this.computer.opt.lightCycleTextures[0])});for(i=-1;i<=1;i++)for(s=-1;s<=1;s++)o=new THREE.Mesh(h,d),o.position.set(i*c+t*n+r,l,s*c+e*n+r),o.castShadow=!0,this.computer.scene.add(o),this.newTrails.push(o)},o.prototype.modify=function(t,e,i){var s,n,r,l,c=this.computer.size,h=a.default.CELL_SIZE;if(i===u.default.LEFT||i===u.default.RIGHT)for(n=Math.abs(t-this.startedX)+1,r=(this.startedX+t+1)/2*h,l=0;l<9;l++)s=this.newTrails[l],s.scale.x=n,s.position.x=o.XOFF[l]*c+r;else for(n=Math.abs(e-this.startedY)+1,r=(this.startedY+e+1)/2*h,l=0;l<9;l++)s=this.newTrails[l],s.scale.z=n,s.position.z=o.ZOFF[l]*c+r;if(this.startedX!==t&&this.startedY!=e)throw"This is very bad."},o.prototype.endAt=function(t,e,i){i===u.default.RIGHT?this.modify(t-1,e,i):i===u.default.DOWN?this.modify(t,e-1,i):i===u.default.LEFT?this.modify(t+1,e,i):i===u.default.UP&&this.modify(t,e+1,i),this.newTrails=[]}},function(t,e){"use strict";function i(){this.textures={},this.models={}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i,i.prototype.autoLoad=function(t,e,i){var s=0;for(var o in t.textures)this.loadTexture(o),s+=t.textures[o],e(s/t.totalSize);i()},i.prototype.loadTexture=function(t){this.textures[t]=THREE.ImageUtils.loadTexture(t)},i.prototype.getTexture=function(t){return this.textures[t]||this.loadTexture(t),this.textures[t]},i.prototype.loadModel=function(t,e){var i=this,s=function(s){i.models[t]=s,e()},o=new THREE.JSONLoader;o.load(t,s,"textures")},i.prototype.getModel=function(t){return this.models[t]}}]);